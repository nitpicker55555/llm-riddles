<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/htmx.org@1.9.5"></script>
    <!--    <link rel="stylesheet" href="../statics/style.css">-->
    <title>æˆ‘è¢«LLMåŒ…å›´å•¦ï¼</title>
    <style>
        #myConfettiContainer {
            pointer-events: none;
            position: fixed;  /* æˆ–ä½¿ç”¨ 'fixed'ï¼Œå¦‚æœéœ€è¦åœ¨æ»šåŠ¨æ—¶ä¿æŒä½ç½®ä¸å˜ */
            top: 0;
            width: 100%;        /* å®¹å™¨å®½åº¦ä¸º100% */
            z-index: 9;
            /* å¯ä»¥æ ¹æ®éœ€è¦æ·»åŠ æ›´å¤šçš„æ ·å¼ */
        }
        #timer {
            display: none;
            position: relative; /* ç¡®ä¿divä¹Ÿæ˜¯å®šä½çš„ */
            font-weight: bold;
            font-size: 2em;
            color: gray;
            text-align: center;
        }
        #timer2 {
            /*display: none;*/
            position: relative; /* ç¡®ä¿divä¹Ÿæ˜¯å®šä½çš„ */
            font-weight: bold;
            font-size: 1em;
            color: gray;
            text-align: center;
        }
        #speakInput{
            display: none;
        }
        #championship{
            display: none;
        }
        html, body {
            /*height: 100%;*/
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f7f7f7; /* æˆ–ä»»ä½•æ‚¨é€‰æ‹©çš„é¢œè‰² */
        }
        .title_str {
            position: relative; /* ç¡®ä¿divä¹Ÿæ˜¯å®šä½çš„ */
            font-weight: bold;
            font-size: 2em;
            color: gray;
            text-align: center;
            /*top: 5%; !* æˆ–å…¶ä»–é€‚åˆçš„å€¼ *!*/
            z-index: 1;
        }
        .content-container {
            position: relative; /* ç¡®ä¿divä¹Ÿæ˜¯å®šä½çš„ */
            top: 10px;
            text-align: center;
            z-index: 4; /* è®¾ç½®è¾ƒé«˜çš„z-index */
            /*margin-top: 10%;*/
        }


    </style>
</head>


<body >
<!--<div id="canvas-container"></div>-->
<div class="content-container">
    <div id="myConfettiContainer">
        <!-- è¿™é‡Œæ˜¯æ”¾ç½®è„šæœ¬çš„å®¹å™¨ -->
    </div>

    <!-- partial -->
    <!--    <script src="../statics/script.js"></script>-->
    <h1 id="timer">0 m 0 s</h1>
    <h1 id="timer2">æœ€ä½³æˆç»©;å† å†›ç•™è¨€ï¼š</h1>
    <input type="text" id="speakInput" placeholder="è¾“å…¥é€šå…³ç•™è¨€å§ï¼" class="w-full px-4 border-2 border-purple-700 py-2 rounded-md bg-white placeholder-gray-500 focus:outline-none">
    <button onclick="submitData()" id="championship" class="w-full px-4 py-2 rounded-md bg-purple-700 text-white hover:bg-purple-700 focus:outline-none">æäº¤</button>
    <h1  class="title_str" id="passed_num">
        å®Œè›‹ï¼
    </h1>
    <h1  class="title_str">
        æˆ‘è¢«LLMåŒ…å›´å•¦ï¼
    </h1>

    <div class="w-full max-w-md mx-auto p-6 rounded-md bg-white shadow-lg">

        <h1 class="text-2xl font-bold mb-4 text-center" id="question">
            ğŸ™‚
        </h1>

        <h1 class="text-2xl font-bold mb-4 text-center" id="wholequestion">
            è¯·é€‰æ‹©å…³å¡
        </h1>
        <!-- New input element added here -->
        <textarea
                id="flaskResponse"
                class="w-full px-4 border-2 border-gray-300 py-2 rounded-md mb-4"
                placeholder="ç»“æœåˆ†æ"
                rows="4"
        ></textarea>
        <div id="resultContainer" class="mt-4 h-48 overflow-y-auto border-2 border-gray-300 rounded-md p-3">
            <p id="user" class="whitespace-pre-line"></p>
            <p id="result" class="whitespace-pre-line"></p>
        </div>
        <form method="post" id='prompt_form' class="mt-6">
            <input
                    type="text"
                    id="prompt" name="prompt"
                    class="w-full px-4 border-2 border-purple-700 py-2 rounded-md bg-white placeholder-gray-500 focus:outline-none"
                    placeholder="æ„å»ºæé—®" required
            />
            <div class="flex justify-center mt-4">
                <button
                        id="generateBtn" type="submit"
                        class="w-full px-4 py-2 rounded-md bg-purple-700 text-white hover:bg-purple-700 focus:outline-none"
                >
                    æäº¤
                </button>
            </div>
        </form>
        <!-- Add this form to your existing HTML where you want the new buttons -->
        <h1 class="text-2xl font-bold mb-4 text-center">
            é€‰æ‹©å…³å¡
        </h1>

        <form id='judge_form'  class="grid grid-cols-3 gap-4"  >
            <!-- Replace 'Button Caption 1' with your actual button captions -->
            <button type="button"  data-caption="1-1 åˆæ¥ä¹åˆ°">1-1 åˆæ¥ä¹åˆ°</button>
            <button type="button" class="bg-purple-500 hover:bg-purple-700 text-white rounded-lg" data-caption="1-2 å°è¯•ç‰›åˆ€">1-2 å°è¯•ç‰›åˆ€</button>
            <button type="button" class="bg-purple-500 hover:bg-purple-700 text-white rounded-lg" data-caption="1-3 çŸ­å…µç›¸æ¥">1-3 çŸ­å…µç›¸æ¥</button>
            <button type="button" class="bg-purple-500 hover:bg-purple-700 text-white rounded-lg" data-caption="1-4 ç§»å½¢æ¢å½±">1-4 ç§»å½¢æ¢å½±</button>
            <button type="button" class="bg-purple-500 hover:bg-purple-700 text-white rounded-lg" data-caption="2-1 å±•ç¿…é£ç¿”">2-1 è´¨æ•°é•¿åº¦</button>
            <button type="button" class="bg-purple-500 hover:bg-purple-700 text-white rounded-lg" data-caption="2-2 è™šå¼ å£°åŠ¿">2-2 è™šå¼ å£°åŠ¿</button>
            <button type="button" class="bg-purple-500 hover:bg-purple-700 text-white rounded-lg" data-caption="2-3 è¶…çº§å ¡å’">2-3 è¶…çº§å ¡å’</button>
            <button type="button" class="bg-purple-500 hover:bg-purple-700 text-white rounded-lg" data-caption="2-4 é“å£é“œå¢™">2-4 è­¦ä¸–åè¨€</button>
            <button type="button" class="bg-purple-500 hover:bg-purple-700 text-white rounded-lg" data-caption="2-5 å¼€å¹³è¾Ÿåœ°">2-5 å¼€å¤©è¾Ÿåœ°</button>
            <button type="button" class="bg-purple-500 hover:bg-purple-700 text-white rounded-lg" data-caption="2-6 å¾—å¯¸è¿›ç‹—">2-6 å¾—å¯¸è¿›ç‹—</button>
            <button type="button" class="bg-purple-500 hover:bg-purple-700 text-white rounded-lg" data-caption="3-1 è‡ªå¾—å…¶ä¹">3-1 è‡ªå¾—å…¶ä¹</button>
            <button type="button" class="bg-purple-500 hover:bg-purple-700 text-white rounded-lg" data-caption="3-2 å¾ªå¾ªå–„è¯±">3-2 å¾ªå¾ªå–„è¯±</button>
            <button type="button" class="bg-purple-500 hover:bg-purple-700 text-white rounded-lg" data-caption="3-3 è™šæ€€è‹¥è°·">3-3 è™šæ€€è‹¥è°·</button>
            <button type="button" class="bg-purple-500 hover:bg-purple-700 text-white rounded-lg" data-caption="4-3 è‡ªæ•‘ä¹‹æœ¯">4-3 è‡ªæ•‘ä¹‹æœ¯</button>
            <button type="button" class="bg-purple-500 hover:bg-purple-700 text-white rounded-lg" data-caption="5-1 å£æ˜¯å¿ƒé">5-1 å£æ˜¯å¿ƒé</button>
            <!--    <button type="button" class="bg-purple-500 hover:bg-purple-700 text-white rounded-lg" data-caption="5-2 å¾ªç¯å¾€å¤">5-2 å¾ªç¯å¾€å¤</button>-->
            <!--    <button type="button" class="bg-purple-500 hover:bg-purple-700 text-white rounded-lg" data-caption="5-3 æƒœå­—å¦‚é‡‘">5-3 æƒœå­—å¦‚é‡‘</button>-->
            <!--    <button type="button" class="bg-purple-500 hover:bg-purple-700 text-white rounded-lg" data-caption="5-4 jsonå¤§ç‹">5-4 jsonå¤§ç‹</button>-->
            <!--    <button type="button" class="bg-purple-500 hover:bg-purple-700 text-white rounded-lg" data-caption="5-5 å°±å¿˜åˆå¿ƒ">5-5 å°±å¿˜åˆå¿ƒ</button>-->
            <!--    <button type="button" class="bg-purple-500 hover:bg-purple-700 text-white rounded-lg" data-caption="5-6 ä¸å¿˜åˆå¿ƒ">5-6 ä¸å¿˜åˆå¿ƒ</button>-->
            <!--    <button type="button" class="bg-purple-500 hover:bg-purple-700 text-white rounded-lg" data-caption="5-7 å°±å¿˜åˆå¿ƒ">5-7 å°±å¿˜åˆå¿ƒ</button>-->

            <!-- Add more buttons as needed -->
        </form>
    </div>
    </div>
        <script>
            window.onload = function() {
                // è¿™é‡Œæ”¾ç½®æ‚¨å¸Œæœ›åœ¨é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œçš„ä»£ç 
                console.log("é¡µé¢åŠ è½½å®Œæˆï¼");
                fetch('/api/min_time')
                    .then(response => response.json())
                    .then(data => {
                        if (data.error) {
                            document.getElementById('timer2').innerHTML = 'No data found';
                        } else {
                            console.log(`Time: ${data.time}, Speak: ${data.speak}`)
                            document.getElementById('timer2').innerHTML =
                                `æœ€ä½³æˆç»©: ${convertToMinAndSec(data.time)}, å† å†›ç•™è¨€: ${data.speak}`;
                        }
                    })
                    .catch(error => console.error('Error:', error));
                // å…¶ä»–åŠŸèƒ½æˆ–é€»è¾‘
            };
            var timer; // ç”¨äºå­˜å‚¨è®¡æ—¶å™¨
            var seconds = 0; // è®¾ç½®åˆå§‹æ—¶é—´

            function startTimer() {
                // è·å–h1æ ‡ç­¾
                var timerElement = document.getElementById("timer");
                var timerElement2 = document.getElementById("timer2");
                // æ˜¾ç¤ºè®¡æ—¶å™¨
                timerElement.style.display = 'block';
                // timerElement2.style.display='block';
                // é˜²æ­¢å¤šæ¬¡ç‚¹å‡»åˆ›å»ºå¤šä¸ªè®¡æ—¶å™¨
                if (timer) {
                    // clearInterval(timer);
                }else{
                    // æ¯ç§’æ›´æ–°æ—¶é—´
                    timer = setInterval(function() {
                        seconds++;
                        var minutes = Math.floor(seconds / 60); // è®¡ç®—åˆ†é’Ÿ
                        var remainingSeconds = seconds % 60;    // è®¡ç®—å‰©ä½™ç§’æ•°

                        // æ ¼å¼åŒ–æ˜¾ç¤º
                        timerElement.innerHTML = minutes + " åˆ† " + remainingSeconds + " ç§’";
                    }, 1000);

                }


            }
            function stopTimer() {
                if (timer) {
                    clearInterval(timer); // æ¸…é™¤è®¡æ—¶å™¨
                }
            }
            function convertToSeconds(timeStr) {
                // åˆ†å‰²å­—ç¬¦ä¸²ä»¥è·å–åˆ†é’Ÿå’Œç§’æ•°
                const parts = timeStr.match(/(\d+)\s*åˆ†\s*(\d+)\s*ç§’/);
                if (parts && parts.length === 3) {
                    const minutes = parseInt(parts[1], 10);
                    const seconds = parseInt(parts[2], 10);
                    return minutes * 60 + seconds; // å°†åˆ†é’Ÿè½¬æ¢ä¸ºç§’å¹¶åŠ ä¸Šç§’æ•°
                } else {
                    return 0; // å¦‚æœæ ¼å¼ä¸åŒ¹é…ï¼Œåˆ™è¿”å› 0 æˆ–é”™è¯¯å¤„ç†
                }
            }
            function convertToMinAndSec(seconds) {
                // åˆ†å‰²å­—ç¬¦ä¸²ä»¥è·å–åˆ†é’Ÿå’Œç§’æ•°

                var minutes = Math.floor(seconds / 60); // è®¡ç®—åˆ†é’Ÿ
                var remainingSeconds = seconds % 60;    // è®¡ç®—å‰©ä½™ç§’æ•°
                return minutes + " åˆ† " + remainingSeconds + " ç§’";


            }
            // ç¤ºä¾‹ä½¿ç”¨

            function submitData() {
                // è·å–æ–‡æœ¬æ¡†å’Œæ—¶é—´æ ‡ç­¾çš„å€¼
                var speakValue = document.getElementById('speakInput').value;
                // var timeValue = "20 åˆ† 10 ç§’";
                var timeValue = document.getElementById('timer').innerHTML;

                const totalSeconds = convertToSeconds(timeValue);
                console.log("totalSeconds",totalSeconds); // åº”è¯¥è¾“å‡º 1210ï¼ˆå³ 20*60 + 10ï¼‰
                // å‘é€æ•°æ®åˆ° Flask åç«¯
                fetch('/api/add_entry', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ speak: speakValue, time: totalSeconds })
                })
                    .then(response => response.json())
                    .then(data => {
                        console.log(data);
                        alert(data['message']);
                        if (data['champion']!==""){
                            alert(data['champion']);
                        }
                    })
                    .catch((error) => {
                        console.error('Error:', error);
                    });
            }


            document.addEventListener("DOMContentLoaded", function() {
                var buttons = document.querySelectorAll("#judge_form button");
                buttons.forEach(function(button) {
                    button.classList.add("m-2", "bg-gray-400", "hover:bg-gray-900", "text-white", "rounded-lg");
                    button.addEventListener('click', function() {

                        var caption = this.getAttribute('data-caption');
                        sendCaption(caption);

                        buttons.forEach(function(button) {
                            button.classList.remove("bg-gray-900");

                        });
                        this.classList.add('bg-gray-900');
                        document.getElementById('resultContainer').innerHTML ='';
                        document.getElementById("flaskResponse").value ='';

                    });


// éå†è¿™äº›æŒ‰é’®

                });


            });
            var promptForm = document.getElementById('prompt_form');
            var resultContainer = document.getElementById('resultContainer');
            var buttons = document.querySelectorAll("#judge_form button");
            function sendCaption(caption) {
                // Initialize a new AJAX request
                var xhr = new XMLHttpRequest();
                xhr.open('POST', '/judge', true);
                xhr.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');

                // Set up what happens when the request is successful
                xhr.onload = function () {
                    if (xhr.status >= 200 && xhr.status < 400) {
                        // Handle success
                        var response = JSON.parse(xhr.responseText);
                        console.log(response.result);
                        document.getElementById("question").textContent  = response.result;
                        document.getElementById("wholequestion").textContent  = response.question;
                    } else {
                        // Handle error
                        console.error('Error from server');
                    }
                };

                // Set up what happens in case of error
                xhr.onerror = function () {
                    // Handle network errors
                    console.error('Network error');
                };

                // Send the AJAX request with the caption as data
                xhr.send(JSON.stringify({caption: caption}));
            }

            function addUserChat(prompt, mode = "You") {
                var userMessageElement = document.createElement("p");
                if (mode === "You") {
                    userMessageElement.classList.add("border-dashed", "bg-gray-200", "p-2");
                }
                else{
                    userMessageElement.classList.add("border-dashed", "bg-red-200", "p-2");
                }
                userMessageElement.innerHTML = "<strong>" + mode + ":</strong> " + prompt;
                resultContainer.innerHTML = userMessageElement.outerHTML;
            }

            promptForm.addEventListener('submit', async function(event) {
                startTimer();
                event.preventDefault();
                var processed_error_indication

                var prompt = promptForm.elements.prompt.value;


                //

                //




                try {
                    const response = await fetch('/judge-route', {  //åˆ¤æ–­input
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ prompt: prompt }),
                    });

                    const result = await response.json();

                    if (result.success) {
                        // Do something if the judge function returns true
                        addUserChat(prompt);

                        var formData = new FormData(promptForm);
                        formData.append('prompt', prompt);

                        promptForm.elements.prompt.value = "";

                        try {
                            const response = await fetch('{{url_for('landing')}}', {
                                method: 'POST',
                                body: formData
                            });
                            const reader = response.body.getReader();

                            var aiMessageElement = document.createElement("p");
                            var ai_raw_message=""
                            aiMessageElement.classList.add("border", "p-2", "whitespace-pre-line", "py-2", "bg-green-100");
                            aiMessageElement.innerHTML = "<strong>AI:</strong>" + " ";
                            resultContainer.appendChild(aiMessageElement);

                            while (true) {
                                const { done, value } = await reader.read();
                                if (done) break;
                                const text = new TextDecoder().decode(value);
                                aiMessageElement.textContent += text;
                                ai_raw_message+=text;
                            }
                            console.log('ai_raw_message', ai_raw_message);
                            fetch('/process_data', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({ value: ai_raw_message })
                            })
                                .then(response => response.json())
                                .then(data => {
                                    // å¤„ç†ä» Flask è¿”å›çš„æ•°æ®
                                    console.log('data.response', data.response);
                                    processed_error_indication= data.response
                                    // document.getElementById("flaskResponse").value = data.response;

                                })
                                .catch((error) => {
                                    console.error('Error:', error);
                                });

                        } catch (error) {
                            console.error(error);
                        }
                        try {
                            const response =await  fetch('/judge-route', {  //åˆ¤æ–­output
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({ response:  ai_raw_message }),
                            });
                            console.log("response",response)

                            const response_result =  await response.json();
                            console.log("response_result",response_result)

                            if (response_result.success) {
                                document.getElementById("flaskResponse").value="æˆåŠŸï¼"
                                buttons.forEach(function(button) {
                                    // æ£€æŸ¥æŒ‰é’®çš„ç±»åæ˜¯å¦åŒ…å«'bg-gray-900'
                                    if(button.classList.contains('bg-gray-900')) {
                                        // è¾“å‡ºæŒ‰é’®çš„æ–‡æœ¬ï¼ˆcaptionï¼‰
                                        button.classList.add("bg-green-900");
                                        console.log(button);
                                    }

                                });
                                var passed_num=0;

                                buttons.forEach(function(button) {
                                    // æ£€æŸ¥æŒ‰é’®çš„ç±»åæ˜¯å¦åŒ…å«'bg-gray-900'
                                    if(button.classList.contains('bg-green-900')) {
                                        // è¾“å‡ºæŒ‰é’®çš„æ–‡æœ¬ï¼ˆcaptionï¼‰
                                        passed_num+=1;
                                        console.log('passed_num ', passed_num);

                                    }


                                });
                                document.getElementById('passed_num').innerHTML =
                                    '<span style="color: green;">è¿‡å…³ï¼š' + passed_num.toString() + '</span>' +
                                    '<span style="color: gray;">' + "/15" + '</span>';
                                if (passed_num===15){
                                    stopTimer();

                                    document.getElementById("championship").style.display='block';
                                    document.getElementById("speakInput").style.display='block';
                                    document.getElementById("flaskResponse").value="é€šå…³ï¼ï¼ï¼ï¼"
                                    alert("æ­å–œé€šå…³ï¼ï¼ï¼å¡«å†™ä½ çš„é€šå…³ç•™è¨€å§ï¼")
                                    var colors = ["DodgerBlue", "OliveDrab", "Gold", "Pink", "SlateBlue", "LightBlue", "Violet", "PaleGreen", "SteelBlue", "SandyBrown", "Chocolate", "Crimson"];

                                    startConfetti(3600,1,colors,5000);

                                }else {
                                    // var colors = ["PaleGreen", "OliveDrab","PaleGreen"];
                                    var colors = ["DodgerBlue", "OliveDrab", "Gold", "Pink", "SlateBlue", "LightBlue", "Violet", "PaleGreen", "SteelBlue", "SandyBrown", "Chocolate", "Crimson"];

                                    startConfetti(300,1,colors,2500);
                                }

                            } else {
                                // addUserChat("è¾“å‡ºç»“æœä¸ç¬¦åˆå½“å‰å…³å¡è¦æ±‚ï¼","error")
                                console.log("processed_error_indication",processed_error_indication)
                                document.getElementById("flaskResponse").value="è¾“å‡ºç»“æœä¸ç¬¦åˆå½“å‰å…³å¡è¦æ±‚(æ³¨æ„ç©ºæ ¼ä¹Ÿç®—ä½œå­—æ•°)ï¼ä»¥ä¸‹æ˜¯QAçš„åˆ†æï¼Œä¹Ÿè®¸å¯¹ä½ æœ‰å¸®åŠ©ï¼š\n"+processed_error_indication
                                console.log('output judge not success:', response_result.message);
                                buttons.forEach(function(button) {
                                    // æ£€æŸ¥æŒ‰é’®çš„ç±»åæ˜¯å¦åŒ…å«'bg-gray-900'
                                    if(button.classList.contains('bg-gray-900')) {
                                        // è¾“å‡ºæŒ‰é’®çš„æ–‡æœ¬ï¼ˆcaptionï¼‰
                                        button.classList.add("bg-gray-600");
                                        console.log(button);
                                    }

                                });
                                console.log("run canvas")
                                var colors = ["PaleGreen", "OliveDrab","PaleGreen"];
                                // var colors = ["DodgerBlue", "OliveDrab", "Gold", "Pink", "SlateBlue", "LightBlue", "Violet", "PaleGreen", "SteelBlue", "SandyBrown", "Chocolate", "Crimson"];

                                startConfetti(300,1,colors);
                            }
                        } catch (error) {
                            console.log('output judge Error:', error);
                        }

                    } else {
                        document.getElementById("flaskResponse").value="è¾“å…¥æ ¼å¼ä¸ç¬¦åˆå½“å‰å…³å¡è¦æ±‚ï¼(æ³¨æ„ç©ºæ ¼ä¹Ÿç®—ä½œå­—æ•°)"
                        addUserChat("è¾“å…¥æ ¼å¼ä¸ç¬¦åˆå½“å‰å…³å¡è¦æ±‚ï¼(æ³¨æ„ç©ºæ ¼ä¹Ÿç®—ä½œå­—æ•°)","error")
                        console.log('judge not success:', result.message);

                        buttons.forEach(function(button) {
                            // æ£€æŸ¥æŒ‰é’®çš„ç±»åæ˜¯å¦åŒ…å«'bg-gray-900'
                            if(button.classList.contains('bg-gray-900')) {
                                // è¾“å‡ºæŒ‰é’®çš„æ–‡æœ¬ï¼ˆcaptionï¼‰
                                button.classList.add("bg-gray-600");
                                console.log(button);
                            }
                            else {
                                // console.log('æŒ‰é’®ï¼Œæ ‡é¢˜ä¸º:', button.caption);
                            }
                        });
                        console.log("run canvas")
                        var colors = [ "Violet","Crimson"];
                        // var colors = ["DodgerBlue", "OliveDrab", "Gold", "Pink", "SlateBlue", "LightBlue", "Violet", "PaleGreen", "SteelBlue", "SandyBrown", "Chocolate", "Crimson"];

                        startConfetti(300,1,colors);




                        // å°†scriptå…ƒç´ æ·»åŠ åˆ°æ–‡æ¡£ä¸­




                    }
                } catch (error) {
                    console.log('judge Error:', error);
                }




            });



            //
            // function startConfetti(a,b,c,d){
            //
            // }




            var maxParticleCount = 150;
            // var particleSpeed = 2;
            var startConfetti;
            var stopConfetti;
            var toggleConfetti;
            var removeConfetti;

            // (function() {
                startConfetti = startConfettiInner;
                stopConfetti = stopConfettiInner;
                toggleConfetti = toggleConfettiInner;
                removeConfetti = removeConfettiInner;

                // var colors = ["DodgerBlue", "OliveDrab", "Gold", "Pink", "SlateBlue", "LightBlue", "Violet", "PaleGreen", "SteelBlue", "SandyBrown", "Chocolate", "Crimson"];
                var streamingConfetti = false;
                var animationTimer = null;
                var particles = [];
                var waveAngle = 0;

                function resetParticle(particle, width, height,colors) {
                    particle.color = colors[(Math.random() * colors.length) | 0];
                    particle.x = Math.random() * width;
                    particle.y = Math.random() * height - height;
                    particle.diameter = Math.random() * 10 + 5;
                    particle.tilt = Math.random() * 10 - 10;
                    particle.tiltAngleIncrement = Math.random() * 0.07 + 0.05;
                    particle.tiltAngle = 0;
                    return particle;
                }

                function startConfettiInner(maxParticleCount,particleSpeed,colors,tt=1000) {
                    var container = document.getElementById('myConfettiContainer');
                    var width = window.innerWidth;
                    var height = window.innerHeight;
                    window.requestAnimFrame = (function() {
                        return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || function(callback) {
                            return window.setTimeout(callback, 16.6666667);
                        };
                    })();
                    var canvas = document.getElementById("confetti-canvas");
                    if (canvas === null) {
                        canvas = document.createElement("canvas");
                        canvas.setAttribute("id", "confetti-canvas");
                        canvas.setAttribute("style", "display:block;z-index:999999;pointer-events:none");
                        container.appendChild(canvas);
                        canvas.width = width;
                        canvas.height = height;
                        window.addEventListener("resize", function() {
                            canvas.width = window.innerWidth;
                            canvas.height = window.innerHeight;
                        }, true);
                    }
                    var context = canvas.getContext("2d");
                    while (particles.length < maxParticleCount)
                        particles.push(resetParticle({}, width, height,colors));
                    streamingConfetti = true;
                    if (animationTimer === null) {
                        (function runAnimation() {
                            context.clearRect(0, 0, window.innerWidth, window.innerHeight);
                            if (particles.length === 0)
                                animationTimer = null;
                            else {
                                updateParticles(maxParticleCount,particleSpeed,colors);
                                drawParticles(context);
                                animationTimer = requestAnimFrame(runAnimation);
                            }
                        })();
                    }
                    setTimeout(stopConfettiInner, tt);
                }

                function stopConfettiInner() {
                    streamingConfetti = false;
                }

                function removeConfettiInner() {
                    stopConfetti();
                    particles = [];
                }

                function toggleConfettiInner() {
                    if (streamingConfetti)
                        stopConfettiInner();
                    else
                        startConfettiInner();
                }

                function drawParticles(context) {
                    var particle;
                    var x;
                    for (var i = 0; i < particles.length; i++) {
                        particle = particles[i];
                        context.beginPath();
                        context.lineWidth = particle.diameter;
                        context.strokeStyle = particle.color;
                        x = particle.x + particle.tilt;
                        context.moveTo(x + particle.diameter / 2, particle.y);
                        context.lineTo(x, particle.y + particle.tilt + particle.diameter / 2);
                        context.stroke();
                    }
                }

                function updateParticles(maxParticleCount,particleSpeed,colors) {
                    var width = window.innerWidth;
                    var height = window.innerHeight;
                    var particle;
                    waveAngle += 0.01;
                    for (var i = 0; i < particles.length; i++) {
                        particle = particles[i];
                        if (!streamingConfetti && particle.y < -15)
                            particle.y = height + 100;
                        else {
                            particle.tiltAngle += particle.tiltAngleIncrement;
                            particle.x += Math.sin(waveAngle);
                            particle.y += (Math.cos(waveAngle) + particle.diameter + particleSpeed) * 0.5;
                            particle.tilt = Math.sin(particle.tiltAngle) * 15;
                        }
                        if (particle.x > width + 20 || particle.x < -20 || particle.y > height) {
                            if (streamingConfetti && particles.length <= maxParticleCount)
                                resetParticle(particle, width, height,colors);
                            else {
                                particles.splice(i, 1);
                                i--;
                            }
                        }
                    }
                }


        </script>


</body>
</html>